# راهنمای سیستم لایسنس و سوپر ادمین آفلاین

## 🎯 هدف سیستم

این سیستم برای کنترل کامل دسترسی و مدیریت لایسنس نرمافزار طراحی شده است. شامل دو سطح دسترسی:
- **سوپر ادمین**: مالک اصلی سیستم با دسترسی کامل
- **کاربران عادی**: دسترسی محدود بر اساس لایسنس

## 🏗️ معماری سیستم

### کامپوننتهای اصلی:
1. **SuperAdminManager.php** - مدیریت سوپر ادمین جداگانه
2. **LicenseManager.php** - مدیریت لایسنس (بهروزرسانی شده)
3. **super_admin_login.php** - ورود سوپر ادمین
4. **super_admin_panel.php** - پنل کامل سوپر ادمین
5. **system_setup.php** - راهاندازی خودکار کامل

### جداول دیتابیس:
- **super_admin** - اطلاعات سوپر ادمین
- **system_license** - اطلاعات لایسنس
- **users** - کاربران عادی سیستم

## 🚀 راهاندازی سیستم

### مرحله 1: راهاندازی خودکار (توصیه شده)
```
http://localhost/motor/system_setup.php
```

این اسکریپت:
- ✅ بررسی پیشنیازها
- ✅ راهاندازی دیتابیس
- ✅ ایجاد سوپر ادمین
- ✅ تولید لایسنس اولیه
- ✅ تست کامل سیستم

### مرحله 2: راهاندازی دستی

#### 2.1 کپی فایلها:
```
includes/SuperAdminManager.php
includes/LicenseManager.php (بهروزرسانی شده)
super_admin_login.php
super_admin_panel.php
system_setup.php
```

#### 2.2 ایجاد جداول:
```sql
-- جدول سوپر ادمین
CREATE TABLE super_admin (
    id INT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    master_key VARCHAR(255) NOT NULL,
    hardware_id VARCHAR(255) NOT NULL,
    status ENUM('active', 'disabled') DEFAULT 'active',
    last_login DATETIME NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- جدول لایسنس (خودکار ایجاد میشود)
```

## 👑 مدیریت سوپر ادمین

### ویژگیهای سوپر ادمین:
- **دسترسی کامل** به تمام بخشهای سیستم
- **مدیریت لایسنس** (تولید، فعالسازی، تمدید، غیرفعالسازی)
- **مستقل از کاربران عادی** - جدول جداگانه
- **امنیت بالا** - مرتبط با Hardware ID
- **تغییر رمز عبور** امن

### دسترسی به پنل سوپر ادمین:
```
http://localhost/motor/super_admin_login.php
```

### اطلاعات ورود اولیه:
- **نام کاربری**: superadmin
- **رمز عبور**: تولید خودکار (نمایش در system_setup.php)

## 🔐 سیستم لایسنس

### ویژگیهای لایسنس:
- **Hardware ID یونیک** برای هر سیستم
- **رمزگذاری AES-256** برای امنیت
- **کنترل تعداد کاربران** قابل تنظیم
- **مدیریت ویژگیها** (گزارشات پیشرفته، چند شعبه، API)
- **تمدید و غیرفعالسازی** توسط سوپر ادمین

### فرآیند مدیریت لایسنس:

#### 1. تولید لایسنس:
```php
// در پنل سوپر ادمین
$licenseKey = $licenseManager->generateLicenseKey(
    $hardwareId,    // شناسه سیستم
    365,            // مدت اعتبار (روز)
    10,             // حداکثر کاربران
    ['feature1']    // ویژگیهای مجاز
);
```

#### 2. فعالسازی لایسنس:
```php
$result = $licenseManager->activateLicense($licenseKey);
```

#### 3. بررسی اعتبار:
```php
$validation = $licenseManager->validateLicense();
if ($validation['valid']) {
    // لایسنس معتبر
}
```

## 🛡️ امنیت سیستم

### سطوح امنیت:

#### 1. سوپر ادمین:
- **جدول جداگانه** از کاربران عادی
- **Master Key** مرتبط با Hardware ID
- **Session جداگانه** با متغیرهای مخصوص
- **دسترسی محدود** فقط از طریق صفحات مخصوص

#### 2. لایسنس:
- **رمزگذاری قوی** AES-256-CBC
- **Hardware ID Binding** - فقط روی سیستم مقصد کار میکند
- **تاریخ انقضا** قابل کنترل
- **ویژگیهای قابل تنظیم**

#### 3. کاربران عادی:
- **محدودیت دسترسی** بر اساس لایسنس
- **عدم دسترسی** به مدیریت لایسنس
- **بررسی خودکار** در هر صفحه

## 🔄 فرآیند کاری

### برای مالک سیستم (سوپر ادمین):
1. ورود از `super_admin_login.php`
2. مدیریت لایسنس در `super_admin_panel.php`
3. تولید لایسنس برای مشتری
4. نظارت بر کل سیستم

### برای مشتری (کاربران عادی):
1. ورود از `login.php`
2. استفاده از سیستم در محدوده لایسنس
3. عدم دسترسی به تنظیمات لایسنس
4. دریافت هشدار انقضا (7 روز قبل)

## 🧪 تست سیستم

### تست خودکار:
```
http://localhost/motor/license_test.php
```

### تستهای دستی:

#### 1. تست سوپر ادمین:
- ورود با اطلاعات صحیح
- تولید لایسنس
- فعالسازی لایسنس
- تغییر رمز عبور

#### 2. تست لایسنس:
- بررسی اعتبار
- تست انقضا
- تست محدودیت کاربران
- تست ویژگیها

#### 3. تست امنیت:
- عدم دسترسی کاربران عادی به پنل سوپر ادمین
- بررسی Hardware ID
- تست رمزگذاری

## 📊 مانیتورینگ

### آمار قابل مشاهده در پنل سوپر ادمین:
- تعداد کاربران سیستم
- تعداد محصولات
- آمار فروش
- وضعیت لایسنس
- روزهای باقیمانده

### لاگهای سیستم:
- خطاهای لایسنس در `logs/error_*.log`
- فعالیت سوپر ادمین
- تغییرات لایسنس

## 🚨 عیبیابی

### مشکلات رایج:

#### 1. "سوپر ادمین یافت نشد":
- اجرای `system_setup.php`
- بررسی جدول `super_admin`
- بررسی Hardware ID

#### 2. "لایسنس نامعتبر":
- تولید لایسنس جدید
- بررسی تاریخ انقضا
- بررسی Hardware ID

#### 3. "دسترسی غیرمجاز":
- ورود از طریق `super_admin_login.php`
- بررسی session variables
- پاک کردن cache مرورگر

### دستورات مفید:
```sql
-- مشاهده سوپر ادمین
SELECT * FROM super_admin;

-- مشاهده لایسنس
SELECT * FROM system_license;

-- بازنشانی سوپر ادمین
DELETE FROM super_admin;

-- بازنشانی لایسنس
DELETE FROM system_license;
```

## 📦 تحویل به مشتری

### فایلهای ضروری:
- تمام فایلهای سیستم اصلی
- فایلهای سوپر ادمین و لایسنس
- راهنمای کاربر
- اطلاعات ورود اولیه

### مراحل تحویل:
1. **نصب سیستم** روی سرور مشتری
2. **اجرای system_setup.php** برای راهاندازی
3. **تحویل اطلاعات سوپر ادمین** به مالک
4. **آموزش کاربران** عادی
5. **تست نهایی** تمام قابلیتها

### اطلاعات تحویل:
```
🔐 سوپر ادمین:
URL: http://domain.com/motor/super_admin_login.php
نام کاربری: [تولید خودکار]
رمز عبور: [تولید خودکار]

👥 کاربران عادی:
URL: http://domain.com/motor/login.php
نام کاربری: admin
رمز عبور: admin123

📋 مدیریت:
- لایسنس: 1 سال
- حداکثر کاربران: 10
- ویژگیها: همه فعال
```

## ✅ چکلیست نهایی

### راهاندازی:
- [ ] اجرای `system_setup.php`
- [ ] تست ورود سوپر ادمین
- [ ] تست ورود کاربر عادی
- [ ] بررسی وضعیت لایسنس
- [ ] تست تولید لایسنس جدید

### امنیت:
- [ ] تغییر رمز سوپر ادمین
- [ ] تغییر رمز admin
- [ ] بررسی محدودیت دسترسی
- [ ] تست Hardware ID

### عملکرد:
- [ ] تست تمام APIها
- [ ] بررسی سرعت سیستم
- [ ] تست بکاپ
- [ ] مانیتورینگ لاگها

**سیستم لایسنس و سوپر ادمین آماده تحویل است! 🎉**